---
name:                      "Molecule: Github actions pipeline"
on:
  schedule:
    - cron:                    "0 21 * * *"
  push:
    branches:
      - develop
  pull_request:
    types:
      - main
      - master

jobs:
  molecule:
    name:                      "Molecule: Job"
    runs-on:                   ubuntu-latest
    container:
        image:                 ghcr.io/pandemonium1986/alpine312:latest
        volumes:
          - /var/run/docker.sock:/var/run/docker.sock
          - ${{ github.workspace }}:/opt/workspace/${{ github.repository }}
        env:
          ANSIBLE_FORCE_COLOR: "1"
          PY_COLORS:           "1"
        options:               >-
          --workdir /opt/workspace/${{ github.repository }}
    steps:
      - name:                  "Init: Run checkout@v2"
        uses:                  actions/checkout@v2
      - name:                  "Ansible: Lint role"
        uses:                  ansible/ansible-lint-action@master
        with:
          targets:             "./"
      - name:                  "Molecule: Create"
        run:                   molecule create
      - name:                  "Molecule: Converge"
        run:                   molecule converge
      - name:                  "Molecule: Idempotence"
        run:                   molecule idempotence
      - name:                  "Molecule: Verify"
        run:                   molecule verify
      - name:                  "Molecule: Destroy"
        run:                   molecule destroy
